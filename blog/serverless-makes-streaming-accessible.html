<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">Serverless Makes Streaming Accessible | Buz</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://buz.dev/blog/serverless-makes-streaming-accessible"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" name="Buz" description="Streaming, simplified." content="data, processing, streaming, quality, contracts"><meta data-rh="true" property="og:image" content="https://buz.dev/img/buzz.png"><meta data-rh="true" property="twitter:image" content="https://buz.dev/img/buzz.png"><meta data-rh="true" property="og:title" content="Serverless Makes Streaming Accessible | Buz"><meta data-rh="true" name="description" content="Streaming systems have long been inaccessible to many companies, simply due to complexity. Serverless technologies make streaming accessible and will completely change data processing as we know it."><meta data-rh="true" property="og:description" content="Streaming systems have long been inaccessible to many companies, simply due to complexity. Serverless technologies make streaming accessible and will completely change data processing as we know it."><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2023-02-22T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/jakthom"><meta data-rh="true" property="article:tag" content="serverless event tracking,serverless snowplow analytics,google cloud run,pub/sub,bigquery,postgres"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://buz.dev/blog/serverless-makes-streaming-accessible"><link data-rh="true" rel="alternate" href="https://buz.dev/blog/serverless-makes-streaming-accessible" hreflang="en"><link data-rh="true" rel="alternate" href="https://buz.dev/blog/serverless-makes-streaming-accessible" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Buz RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Buz Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-E9VYMMT9R3"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-E9VYMMT9R3",{})</script>


<script>!function(e,o,a,s,n,t,p){e[n]||(e.GlobalSnowplowNamespace=e.GlobalSnowplowNamespace||[],e.GlobalSnowplowNamespace.push(n),e[n]=function(){(e[n].q=e[n].q||[]).push(arguments)},e[n].q=e[n].q||[],t=o.createElement(a),p=o.getElementsByTagName(a)[0],t.async=1,t.src="https://cdn.jsdelivr.net/npm/@snowplow/javascript-tracker@3.4.0/dist/sp.js",p.parentNode.insertBefore(t,p))}(window,document,"script",0,"snowplow"),snowplow("newTracker","sp","docstream.buz.dev",{appId:"buz-docs",platform:"web",withCredentials:!1,cookieSameSite:"Lax",discoverRootDomain:!0})</script><link rel="stylesheet" href="/assets/css/styles.0cdbffef.css">
<link rel="preload" href="/assets/js/runtime~main.b6af85fc.js" as="script">
<link rel="preload" href="/assets/js/main.cc0a86d3.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="theme.common.skipToMainContent"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/bee2.svg" alt="Buz" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/bee2.svg" alt="Buz" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Buz</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a href="https://discord.gg/JFKVnVdF2m" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/silverton-io/buz" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/birds-bees-and-organizing-your-data-with-duckdb-and-buz">Birds, Bees, and well-structured piles of JSON</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/blog/serverless-makes-streaming-accessible">Serverless Makes Streaming Accessible</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/the-contract-powered-data-platform">The Contract-Powered Data Platform</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/make-it-easy">Make It Easy</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="title_f1Hy" itemprop="headline">Serverless Makes Streaming Accessible</h1><div class="container_mt6G margin-vert--md"><time datetime="2023-02-22T00:00:00.000Z" itemprop="datePublished">February 22, 2023</time> ¬∑ <!-- -->12 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/jakthom" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/jakthom.png" alt="Jake"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/jakthom" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Jake</span></a></div><small class="avatar__subtitle" itemprop="description">üêù</small></div></div></div></div></header><div id="post-content" class="markdown" itemprop="articleBody"><p><a href="https://snowplow.io/" target="_blank" rel="noopener noreferrer">Snowplow Analytics</a> is a highly-scalable system that powers <a href="https://snowplow.io/blog/why-data-contracts-are-obviously-a-good-idea/" target="_blank" rel="noopener noreferrer">structured data creation</a> for <a href="https://trends.builtwith.com/analytics/Snowplow" target="_blank" rel="noopener noreferrer">millions of sites</a> on the internet. Snowplow tracking is incorporated into <a href="https://github.com/dbt-labs/dbt-core/blob/main/core/dbt/tracking.py#L33-L47" target="_blank" rel="noopener noreferrer">dbt</a>, <a href="https://cloud.getdbt.com/" target="_blank" rel="noopener noreferrer">dbt cloud</a>, <a href="https://trello.com/" target="_blank" rel="noopener noreferrer">Trello</a>, <a href="https://gitlab.com/" target="_blank" rel="noopener noreferrer">Gitlab</a>, <a href="https://www.citi.com/" target="_blank" rel="noopener noreferrer">Citi bank</a>, <a href="https://www.backcountry.com/" target="_blank" rel="noopener noreferrer">Backcountry.com</a>, and the list goes on.</p><p>After setting up data infrastructure <a href="https://bostata.com/268-billion-events-with-snowplow-snowflake-at-cargurus" target="_blank" rel="noopener noreferrer">like Snowplow</a> for <a href="https://bostata.com/client-side-instrumentation-for-under-one-dollar" target="_blank" rel="noopener noreferrer">years</a>  I&#x27;ve frequently found myself wishing for both <strong>less</strong> and <strong>more</strong>.</p><p><strong>Fewer streams</strong>, <strong>fewer machines or containers to manage</strong>, <strong>fewer moving pieces to help prevent event duplication or loss</strong>, <strong>less configuration</strong>, and <strong>less in-house documentation to keep things running</strong> would be a dream.</p><p><strong>Deployment flexibility</strong>, <strong>flexible schema storage</strong>, <strong>cost efficiencies</strong>, <strong>seamless migration between transport systems</strong>, <strong>improved utility from the data in transit</strong>, and <strong>increased visibility</strong> would also be very helpful.</p><p>Meanwhile, serverless technologies have come into their own and point the way toward a very bright data-processing future. Which is how <strong><a href="https://buz.dev" target="_blank" rel="noopener noreferrer">buz.dev</a></strong> was born.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="inspirations-and-iterations">Inspirations and iterations<a class="hash-link" href="#inspirations-and-iterations" title="Direct link to heading">‚Äã</a></h2><p>My first iteration of &quot;serverless Snowplow Analytics&quot; was in 2018.  I stitched together a <a href="https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/distribution-working-with.html" target="_blank" rel="noopener noreferrer">Cloudfront distribution</a>, a <a href="https://docs.aws.amazon.com/lambda/latest/dg/lambda-python.html" target="_blank" rel="noopener noreferrer">Python-based Lambda function</a>, S3, and the <a href="https://www.jsdelivr.com/package/npm/@snowplow/javascript-tracker?path=dist" target="_blank" rel="noopener noreferrer">Snowplow javascript tracker</a> to stockpile event data. A series of <a href="https://docs.aws.amazon.com/athena/latest/ug/creating-tables.html" target="_blank" rel="noopener noreferrer">Athena external tables</a> sat on top of the raw data and voila! Near-real-time analytics for practically free. It worked so well <a href="https://bostata.com/client-side-instrumentation-for-under-one-dollar/" target="_blank" rel="noopener noreferrer">a blog post was written</a> and other people were inspired to <a href="https://discourse.snowplow.io/t/snowplow-serverless/1912/14" target="_blank" rel="noopener noreferrer">build</a> or <a href="https://www.ownyourbusinessdata.net/enrich-snowplow-data-with-aws-lambda-function/" target="_blank" rel="noopener noreferrer">write about</a> the same. The system ran hands-off with very little effort on my part, thanks to <strong>minimal moving pieces</strong> and <strong>AWS having the responsibility of keeping it up and running</strong>. </p><p>Serverless event collection worked very well at scale during my time at <a href="https://www.cargurus.com/" target="_blank" rel="noopener noreferrer">CarGurus</a>. While we had a Snowplow Analytics implementation, a colleage wanted to see what AWS Lambda could handle. The marketing team sent enormous amounts of email using a combination of <a href="https://iterable.com/" target="_blank" rel="noopener noreferrer">Iterable</a> and <a href="https://help.dyn.com/email-delivery-gsg/" target="_blank" rel="noopener noreferrer">Dyn</a>, and each blast would result in production systems being absolutely swamped with tracking callbacks. The analytics team wanted data for analytics or tracking opt-outs, but nobody wanted to provision (normally unused) static infrastructure. Lambda was a perfect fit. The system continuously ramped from 0 to ~20k rps and back again, the AWS bill was laughably small, and it required virtually zero maintenance.</p><p>After setting up Snowplow for a <a href="https://www.bisnow.com/" target="_blank" rel="noopener noreferrer">NYC-based commercial real estate company</a>, the VP of Technology (who is now @ Disney Streaming) pushed my implementation further with a simple Lambda function. Instead of being limited to Snowplow protocol payloads, the Lambda function collected arbitrary json payloads, reformatted them as Snowplow <a href="https://docs.snowplow.io/docs/understanding-tracking-design/out-of-the-box-vs-custom-events-and-entities/#self-describing-events" target="_blank" rel="noopener noreferrer">Self-Describing Events</a>, and fired them into the Snowplow collector. It was efficient and effectively hands-off. I have thought about his work ever since.</p><p>The rich benefits of serverless data processing for robotics and fulfillment were experienced while working at <a href="https://6river.com/data-driven-robotics-leveraging-google-cloud-platform-and-big-data-to-improve-robot-behaviors/" target="_blank" rel="noopener noreferrer">6 River Systems</a> (Shopify Logistics). Data volumes from fulfillment systems are highly variable. One warehouse or distribution center has a very different traffic pattern than another, but volume across all of them spikes to orders of magnitudes higher <a href="https://supplychaingamechanger.com/strategies-to-survive-the-peak-season-fulfillment-surge/" target="_blank" rel="noopener noreferrer">during Peak months</a>. Over-provisioned infrastructure in an industry where margins are already tight is a complete non-starter. Serverless was the only option and did not disappoint.</p><p>And finally, my time working alongside Okta&#x27;s security team has thoroughly solidified the value of serverless technologies in a security-conscious setting. <em>Security teams absolutely love serverless tech.</em> Want proof? Go check out <a href="https://www.matano.dev/" target="_blank" rel="noopener noreferrer">Matano.dev</a>, ask <a href="https://panther.com/" target="_blank" rel="noopener noreferrer">Panther</a> how their systems are built, or dig into <a href="https://aws.amazon.com/blogs/publicsector/how-public-sector-security-teams-can-use-serverless-technologies-improve-outcomes/" target="_blank" rel="noopener noreferrer">AWS marketing materials</a>.</p><p><strong>Serverless is the secret of highly efficient data processing. It is the way to make streaming accessible.</strong></p><h1>Why Build Buz?</h1><p>While incredibly scalable and robust, setting up and maintaining OSS Snowplow is not for the faint of heart. It&#x27;s time-consuming to set up, requires a deep understanding of the moving pieces to tune well, and requires significant engineering resources.</p><p>A very common Snowplow architecture diagram looks like the following, excluding monitoring, alerting, log centralization, and other devops necessities:</p><p><img loading="lazy" alt="snowplow" src="/assets/images/snowplow_arch-5bce4a2a8671352a98ff0d0ada048a7e.png" width="2431" height="1507" class="img_ev3q"></p><p>Opportunity costs matter to cost-conscious buinesses, and engineering resources dedicated to maintaining data pipelines are rarely the best use of said resources. <strong><em>Engineers also prefer to spend their time using streaming data rather than moving it around</em></strong>.</p><p>So my initial goal was to build a system like the following:</p><p><img loading="lazy" alt="serverless thing" src="/assets/images/initial_arch-aa272e4149d79bb767b2a3e12fa7f849.png" width="6586" height="833" class="img_ev3q"></p><p>Snowplow tracking SDK&#x27;s would be used for instrumentation. The serverless collector thing called Buz would collect, validate, and route payloads to S3 via Kinesis Firehose. And Snowflake would provide the compute on top of S3.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="buz-requirements-and-design">Buz Requirements and Design<a class="hash-link" href="#buz-requirements-and-design" title="Direct link to heading">‚Äã</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="minimal-human-involvement-to-keep-running">Minimal human involvement to keep running<a class="hash-link" href="#minimal-human-involvement-to-keep-running" title="Direct link to heading">‚Äã</a></h3><p>Systems are great when you don&#x27;t need to think about them. In <a href="https://twitter.com/b0rk" target="_blank" rel="noopener noreferrer">Julia Evans&#x27;</a> words, spending <strong><a href="https://jvns.ca/blog/2022/07/09/monitoring-small-web-services/" target="_blank" rel="noopener noreferrer">approximately 0 time on operations</a></strong> was the goal.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="self-contained-and-capable-of-running-horizontally-with-no-issue">Self-contained and capable of running horizontally with no issue<a class="hash-link" href="#self-contained-and-capable-of-running-horizontally-with-no-issue" title="Direct link to heading">‚Äã</a></h3><p>There&#x27;s a movement of &quot;small, mighty, and self-contained&quot; afoot within data processing systems.</p><p><em>It&#x27;s because complexity is hard to keep running</em>.</p><p>Systems like <a href="https://redpanda.com/" target="_blank" rel="noopener noreferrer">Redpanda</a>, which crams the Kafka api into a small self-contained binary, or <a href="https://www.benthos.dev/" target="_blank" rel="noopener noreferrer">Benthos</a>, which crams cool stream-processing functionality into a small self-contained binary, are highly inspirational.</p><p>The Serverless Thing called Buz needed to do the same.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="no-jvm-no-spark-no-beam">No JVM, no Spark, no Beam<a class="hash-link" href="#no-jvm-no-spark-no-beam" title="Direct link to heading">‚Äã</a></h3><p>Snowplow&#x27;s <a href="https://docs.snowplow.io/docs/pipeline-components-and-applications/stream-collector/" target="_blank" rel="noopener noreferrer">collector</a>, <a href="https://docs.snowplow.io/docs/pipeline-components-and-applications/enrichment-components/enrich/#enrich-kinesis" target="_blank" rel="noopener noreferrer">enricher</a>, <a href="https://docs.snowplow.io/docs/pipeline-components-and-applications/loaders-storage-targets/s3-loader/" target="_blank" rel="noopener noreferrer">s3 sink</a>, etc all run on the JVM.</p><p>Snowplow&#x27;s <a href="https://docs.snowplow.io/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-rdb-loader-3-0-0/" target="_blank" rel="noopener noreferrer">RDB</a> and <a href="https://docs.snowplow.io/docs/pipeline-components-and-applications/loaders-storage-targets/snowplow-snowflake-loader/" target="_blank" rel="noopener noreferrer">Snowflake</a> loaders run on Spark while the <a href="https://docs.snowplow.io/docs/pipeline-components-and-applications/loaders-storage-targets/bigquery-loader/" target="_blank" rel="noopener noreferrer">BigQuery</a> loader runs on Beam (Cloud Dataflow).</p><p>But... Snowflake&#x27;s <a href="https://docs.snowflake.com/en/user-guide/data-load-snowpipe-intro.html" target="_blank" rel="noopener noreferrer">Snowpipe</a> works well, as do BigQuery <a href="https://cloud.google.com/bigquery/docs/samples/bigquery-table-insert-rows" target="_blank" rel="noopener noreferrer">streaming inserts</a> or  <a href="https://cloud.google.com/pubsub/docs/bigquery" target="_blank" rel="noopener noreferrer">Pub/Sub subscriptions</a>. And the responsibility of keeping Snowpipe or BQ streaming inserts running is offloaded :).</p><p>Serverless Thing was to shed as many dependencies as possible.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="fast-startup-and-shutdown">Fast startup and shutdown<a class="hash-link" href="#fast-startup-and-shutdown" title="Direct link to heading">‚Äã</a></h3><p>Making containers fast to launch makes a big impact on cost as invocations ramp, so Serverless Thing had to be snappy. The faster infrastructure can follow the utilization curve, the more cost-effective it is. In an environment where costs are being scrutinized, <strong>doing work fast</strong> is just as important as <strong>not running at all when there is no work to be done</strong>.</p><p>Being efficient also happens to be pretty damn good for the environment. Burning fewer polar bears seems to <a href="https://medium.com/@intive/this-months-reason-technology-will-save-the-world-energy-savings-and-serverless-principles-375660c8ed81" target="_blank" rel="noopener noreferrer">resonate with others</a> like <a href="https://youtu.be/Z-6SnP6yzgo?t=1826" target="_blank" rel="noopener noreferrer">DuckDB</a> and <a href="https://d39w7f4ix9f5s9.cloudfront.net/e3/79/42bf75c94c279c67d777f002051f/carbon-reduction-opportunity-of-moving-to-aws.pdf" target="_blank" rel="noopener noreferrer">451 Research</a>. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="payload-validation-annotation-and-bifurcation">Payload validation, annotation, and bifurcation<a class="hash-link" href="#payload-validation-annotation-and-bifurcation" title="Direct link to heading">‚Äã</a></h3><p>A very valuable Snowplow feature lies at the <code>Enricher</code>, where each and every event is validated using the associated jsonschema.</p><p>The only way to do this quickly is via a self-warming schema cache, so an onboard cache became another requirement.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="just-json">Just JSON<a class="hash-link" href="#just-json" title="Direct link to heading">‚Äã</a></h3><p>Snowplow data is serialized using <strong><a href="https://thrift.apache.org/" target="_blank" rel="noopener noreferrer">thrift</a></strong> between the collector and the enricher but becomes <strong>tsv</strong> downstream of the enricher. This makes it hard to point a system like <a href="https://materialize.com/" target="_blank" rel="noopener noreferrer">Materialize</a> at the &quot;enriched&quot; stream without first <code>reading tsv records</code> -&gt; <code>formatting as json</code> -&gt; <code>writing to a separate stream</code>. Write amplification quickly becomes reality and the operator must make a choice between <strong>not reading from the stream</strong> or <strong>re-formatting every payload to something that is easily pluggable with other stream processing systems</strong>. At higher volumes this equates to $$$$$.</p><p>While JSON is not the smallest data format it is still more efficient to write JSON once than having many copies of smaller formats. I chose to have <strong>fewer</strong> copies but a <strong>larger per-record format</strong>.</p><p>This decision is tbd. Either way it&#x27;s easy to change certain destinations to parquet.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="easy-to-configure">Easy to configure<a class="hash-link" href="#easy-to-configure" title="Direct link to heading">‚Äã</a></h3><p>Yaml + Jsonschema validation is <a href="https://www.schemastore.org/json/" target="_blank" rel="noopener noreferrer">becoming pretty standard</a>. It turned out to be a pretty good decision since auto-completing, auto-validating config is handy.</p><p>Serverless Thing had to be easy to configure. Bonus points for providing hints in an editor throughout the configuration process.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="make-event-streaming-accessible">Make event streaming accessible<a class="hash-link" href="#make-event-streaming-accessible" title="Direct link to heading">‚Äã</a></h3><p><a href="https://www.getdbt.com/" target="_blank" rel="noopener noreferrer">dbt</a> has been so inspirational because it makes good data engineering practices accessible to all. Tricks that used to pay rent have become dbt packages anyone can import.</p><p>Like the data engineering of not-that-long-ago, today&#x27;s streaming systems are <strong>intimidating</strong>. But they don&#x27;t need to be. These systems are also often <strong>overkill</strong>. Transporting data via several streams only to batch-insert it into a Postgres database means the streaming infrastructure is unnecessary.</p><p>Serverless Thing should make streaming accessible, while making it easy to evolve from the current stack to some desired architecture. Even if that means shipping events to <a href="https://buz.dev/integrations/postgres" target="_blank" rel="noopener noreferrer">Postgres</a> now and <a href="https://buz.dev/integrations/kafka" target="_blank" rel="noopener noreferrer">Kafka</a> later.</p><h1>Progress thus far</h1><p>While Buz has much further to go, the journey of serverless event tracking has already been extremely worthwhile.</p><p>The pain and complexity of streaming systems seems to resonate with <strong><em>many</em></strong> people. <strong>Serverless fixes this pain.</strong></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="expanding-to-more-inputs">Expanding to more inputs<a class="hash-link" href="#expanding-to-more-inputs" title="Direct link to heading">‚Äã</a></h3><p>I had a eureka moment early on - if the serverless model works using <a href="https://docs.snowplow.io/docs/collecting-data/collecting-from-own-applications/snowplow-tracker-protocol/" target="_blank" rel="noopener noreferrer">Snowplow&#x27;s tracker protocol</a> it should work for other protocols. As it turns out, it does! While also minimizing the hassle of running multiple event tracking pipelines - such as one pipeline for each protocol.</p><p><a href="/inputs/cloudNative/cloudevents">Cloudevents</a> with its (optional) <a href="https://cloudevents.github.io/sdk-javascript/interfaces/event_interfaces.CloudEventV1.html#dataschema" target="_blank" rel="noopener noreferrer">dataschema</a> property was a low-effort addition. Fire payloads using the Cloudevents&#x27; <code>data</code> property, provide a schema reference in <code>dataschema</code>, and voila! Validated events without needing to <a href="https://github.com/cloudevents?q=sdk-&amp;type=all&amp;language=&amp;sort=" target="_blank" rel="noopener noreferrer">write the sdk</a>, or quickly hooking into tracking already in existence.</p><p>Pixels and webhooks were fun additions, mostly because these are often painful due to the arbitrary nature of their payloads. But another thought came to mind - validate these too! Since it would be fab to namespace and validate these payloads, named <a href="/inputs/buz/pixel#named-pixels">pixels</a> and <a href="/inputs/buz/webhook#named-webhooks">webhooks</a> came to be.</p><p>Accepting <a href="/inputs/buz/self-describing">self-describing</a> json payloads was a nice addition, and provides some additional flexibility like custom top-level payload property names. It also makes internal SDK&#x27;s a breeze to build.</p><p>In past work lives I&#x27;ve built lightweight sidecars to read <a href="https://www.mongodb.com/docs/manual/changeStreams/" target="_blank" rel="noopener noreferrer">Mongodb change streams</a> or <a href="https://www.postgresql.org/docs/current/logical-replication.html" target="_blank" rel="noopener noreferrer">Postgres logical replication</a> before writing data to systems like Kafka. Serverless Thing naturally lends itself to supporting change data capture, or at least the weird cousin of what CDC looks like today. A lovely example of what could (and/or should) be ubiquitous is <a href="https://tech.devoted.com/avalanche-streaming-postgres-to-snowflake-130e8c477f07?gi=db8239b2a6ad" target="_blank" rel="noopener noreferrer">Devoted Health&#x27;s Avalanche</a> project. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="writing-events-to-a-variety-of-destinations">Writing events to a variety of destinations<a class="hash-link" href="#writing-events-to-a-variety-of-destinations" title="Direct link to heading">‚Äã</a></h3><p><code>Kinesis</code>, <code>Kafka</code>, and <code>Pub/Sub</code> are commonly-supported streaming/transport mechanisms for data systems. All three options work well. But they are often <strong>overkill and debatably net-negative</strong> for:</p><ul><li>Companies with low data volumes or <a href="https://motherduck.com/blog/big-data-is-dead/" target="_blank" rel="noopener noreferrer">not big data</a></li><li>Companies that don&#x27;t <a href="https://twitter.com/tayloramurphy/status/1625995802924445697" target="_blank" rel="noopener noreferrer">need or want legitimately-real-time data access</a></li><li>Non-production environments</li><li>Local development</li></ul><p>At CarGurus I learned the importance of making systems accessible to engineers, regardless of which environment they run in. Product engineers care about one thing: <strong>data gets to where it needs to be, wherever that is.</strong> They typically do not care about <strong>how it gets there</strong> or <strong>where it needs to be for downstream consumption</strong>.</p><p>At Shopify I learned the intricacies of building systems that can be deployed in single-tenant fashion as efficiently as multi-tenant.</p><p>Having flexibility to write data to a variety of systems is a requirement for all of the above, so Buz quickly expanded to support:</p><ul><li><strong><a href="/category/streaming-sinks">Streaming destinations</a></strong> which are best in production at scale.</li><li><strong><a href="/outputs/stream/aws-kinesis-firehose">Streaming hybrids like Kinesis Firehose</a></strong>, because they are hands-off and incredibly powerful for building data lakes.</li><li><strong><a href="/category/database-sinks">Traditional databases</a></strong>, because most every company has one already.</li><li><strong><a href="/outputs/saas/materialize">Streaming databases</a></strong>, because they are the future.</li><li><strong><a href="/category/timeseries-sinks">Timeseries databases</a></strong>, because they unlock some very interesting use cases.</li><li><strong><a href="/category/saas-sinks">Saas products</a></strong>, because product and engineering teams everywhere use them.</li><li><strong><a href="/category/message-broker-sinks">Message brokers</a></strong>, because they are well-loved and very useful.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="writing-events-to-multiple-destinations">Writing events to multiple destinations<a class="hash-link" href="#writing-events-to-multiple-destinations" title="Direct link to heading">‚Äã</a></h3><p>Shopify has a streaming model where <strong>events are written to Kafka for distribution to Datadog for observability and to the data lake.</strong> A secondary model is <strong>simultaneously writing product/marketing events to Amplitude for product analytics and to the data lake.</strong> After seeing how simple yet operationally powerful these are, I had a hard time ignoring them.</p><p>Migrating systems is a very common pain point as needs, volume, and organizations evolve. Migrating from <code>Postgres</code> to <code>Kafka</code> or <code>Kinesis</code> to <code>Kafka</code> are common patterns, and dual writing is the way to do this without blowing everything up. I&#x27;ve often wanted to simply add a configuration block instead of writing a new system that will be thrown away after migration.</p><p><strong>So Buz supports writing to more than one destination. </strong></p><p>There are tradeoffs here that must not be ignored, as the risk of one destination being unavailable goes up pretty quickly when the number of them increases. It&#x27;s a worthwhile ops lever nonetheless.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="flexible-schema-registry-backends-including-using-the-destination-system-as-a-registry">Flexible schema registry backends (including using the destination system as a registry)<a class="hash-link" href="#flexible-schema-registry-backends-including-using-the-destination-system-as-a-registry" title="Direct link to heading">‚Äã</a></h3><p>I&#x27;ve often questioned why data processing systems rarely use the backend they ship data to for serving configuration, schemas, and other runtime resources. Many web apps do this - why don&#x27;t data systems?</p><p>In the spirit of minimizing moving pieces, and because it&#x27;s fun, Buz supports a variety of schema registry backends.</p><p>Interesting use cases this functionality unlocks include:</p><ul><li><strong>Streaming analytics with no streams.</strong> Using <a href="/outputs/saas/materialize">Materialize</a> as the destination as well as the <a href="/blog/schema-registry/backends/saas/materialize">schema registry</a> means streaming insights don&#x27;t rely on much infrastructure.</li><li><strong>Using Postgres as the application database, the event database, and the schema cache.</strong> Introducing event tracking to existing systems has literally never been easier.</li><li><strong>Analytics without a database at all.</strong> Using GCS or S3 for the schema cache and the data lake means a database is not required to get database-like results.</li><li><strong>Seamless tie-in to existing streaming workflows.</strong> If a Kafka or Redpanda schema is already in place, perfect! Yet-another-piece-of-infrastructure‚Ñ¢ should not be necessary.</li></ul><p>These unlocks are incredibly exciting.</p><h1>Where do we go from here?</h1><p>Thanks to serverless tech, we are in the early innings of complete data infrastructure transformation.</p><p>The serverless-first data processing idea seemed crazy for a very long time, <strong>but it&#x27;s definitely not crazy.</strong> Companies like <a href="https://modal.com/" target="_blank" rel="noopener noreferrer">Modal</a> and <a href="https://www.snowflake.com/powered-by/panther-labs/" target="_blank" rel="noopener noreferrer">Panther</a> have been built from the ground-up to power data-oriented serverless workloads, <a href="https://www.fivetran.com/blog/serverless-etl-with-cloud-functions" target="_blank" rel="noopener noreferrer">Fivetran</a> leverages serverless for <a href="https://fivetran.com/docs/functions" target="_blank" rel="noopener noreferrer">custom connectors</a>, DuckDB can be easily <a href="https://twitter.com/mim_djo" target="_blank" rel="noopener noreferrer">tossed into a serverless function</a>, database drivers are <a href="https://planetscale.com/blog/introducing-the-planetscale-serverless-driver-for-javascript" target="_blank" rel="noopener noreferrer">being retooled</a> for <a href="https://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/aurora-serverless-v2.html" target="_blank" rel="noopener noreferrer">serverless workloads</a>, and the list goes on.</p><p>Serverless enables highly-efficient, secure, and low-footprint data workloads. It drastically lowers the complexity bar of data processing systems, and enables teams to spend less time on the boring stuff.</p><p>Buz will continue to be all-in on serverless because it makes streaming accessible.</p></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/serverless-event-tracking">serverless event tracking</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/serverless-snowplow-analytics">serverless snowplow analytics</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/google-cloud-run">google cloud run</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/pub-sub">pub/sub</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/bigquery">bigquery</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/postgres">postgres</a></li></ul></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/birds-bees-and-organizing-your-data-with-duckdb-and-buz"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Birds, Bees, and well-structured piles of JSON</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/the-contract-powered-data-platform"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">The Contract-Powered Data Platform</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#inspirations-and-iterations" class="table-of-contents__link toc-highlight">Inspirations and iterations</a></li><li><a href="#buz-requirements-and-design" class="table-of-contents__link toc-highlight">Buz Requirements and Design</a><ul><li><a href="#minimal-human-involvement-to-keep-running" class="table-of-contents__link toc-highlight">Minimal human involvement to keep running</a></li><li><a href="#self-contained-and-capable-of-running-horizontally-with-no-issue" class="table-of-contents__link toc-highlight">Self-contained and capable of running horizontally with no issue</a></li><li><a href="#no-jvm-no-spark-no-beam" class="table-of-contents__link toc-highlight">No JVM, no Spark, no Beam</a></li><li><a href="#fast-startup-and-shutdown" class="table-of-contents__link toc-highlight">Fast startup and shutdown</a></li><li><a href="#payload-validation-annotation-and-bifurcation" class="table-of-contents__link toc-highlight">Payload validation, annotation, and bifurcation</a></li><li><a href="#just-json" class="table-of-contents__link toc-highlight">Just JSON</a></li><li><a href="#easy-to-configure" class="table-of-contents__link toc-highlight">Easy to configure</a></li><li><a href="#make-event-streaming-accessible" class="table-of-contents__link toc-highlight">Make event streaming accessible</a></li><li><a href="#expanding-to-more-inputs" class="table-of-contents__link toc-highlight">Expanding to more inputs</a></li><li><a href="#writing-events-to-a-variety-of-destinations" class="table-of-contents__link toc-highlight">Writing events to a variety of destinations</a></li><li><a href="#writing-events-to-multiple-destinations" class="table-of-contents__link toc-highlight">Writing events to multiple destinations</a></li><li><a href="#flexible-schema-registry-backends-including-using-the-destination-system-as-a-registry" class="table-of-contents__link toc-highlight">Flexible schema registry backends (including using the destination system as a registry)</a></li></ul></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Sources</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/sources/snowplow-analytics">Snowplow Analytics</a></li><li class="footer__item"><a class="footer__link-item" href="/sources/webhook">Webhooks</a></li><li class="footer__item"><a class="footer__link-item" href="/sources/self-describing-json">Self-Describing JSON</a></li><li class="footer__item"><a class="footer__link-item" href="/sources/pixel">Pixel</a></li><li class="footer__item"><a class="footer__link-item" href="/sources/cloudevents">CloudEvents</a></li></ul></div><div class="col footer__col"><div class="footer__title">Integrations</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/integrations/google-pub-sub">Google Pub/Sub</a></li><li class="footer__item"><a class="footer__link-item" href="/integrations/aws-kinesis-firehose">AWS Kinesis Firehose</a></li><li class="footer__item"><a class="footer__link-item" href="/integrations/kafka">Kafka</a></li><li class="footer__item"><a class="footer__link-item" href="/integrations/redpanda">Redpanda</a></li><li class="footer__item"><a class="footer__link-item" href="/integrations/postgres">Postgres</a></li></ul></div><div class="col footer__col"><div class="footer__title">Buz</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/">Docs</a></li><li class="footer__item"><a href="https://github.com/silverton-io/buz/" target="_blank" rel="noopener noreferrer" class="footer__link-item">On GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2023 Silverton Data, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.b6af85fc.js"></script>
<script src="/assets/js/main.cc0a86d3.js"></script>
</body>
</html>