"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[5128],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return m}});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var c=a.createContext({}),l=function(e){var t=a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},p=function(e){var t=l(e.components);return a.createElement(c.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,o=e.originalType,c=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),u=l(n),m=i,g=u["".concat(c,".").concat(m)]||u[m]||d[m]||o;return n?a.createElement(g,r(r({ref:t},p),{},{components:n})):a.createElement(g,r({ref:t},p))}));function m(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=n.length,r=new Array(o);r[0]=u;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:i,r[1]=s;for(var l=2;l<o;l++)r[l]=n[l];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},84:function(e,t,n){n.r(t),n.d(t,{assets:function(){return p},contentTitle:function(){return c},default:function(){return m},frontMatter:function(){return s},metadata:function(){return l},toc:function(){return d}});var a=n(7462),i=n(3366),o=(n(7294),n(3905)),r=["components"],s={sidebar_position:1},c="GCP",l={unversionedId:"production-deployment/gcp",id:"production-deployment/gcp",title:"GCP",description:"Deploying to Cloud Run (in 4 steps)",source:"@site/docs/production-deployment/gcp.md",sourceDirName:"production-deployment",slug:"/production-deployment/gcp",permalink:"/production-deployment/gcp",draft:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"defaultSidebar",previous:{title:"Telemetry",permalink:"/under-the-hood/tools/telemetry"},next:{title:"AWS",permalink:"/production-deployment/aws"}},p={},d=[{value:"Deploying to Cloud Run (in 4 steps)",id:"deploying-to-cloud-run-in-4-steps",level:2},{value:"1. Create Pub/Sub topics.",id:"1-create-pubsub-topics",level:3},{value:"2. Upload config to Secret Manager.",id:"2-upload-config-to-secret-manager",level:3},{value:"3. Push image to GCP Artifact Registry.",id:"3-push-image-to-gcp-artifact-registry",level:3},{value:"4. Run Buz as a Cloud Run service.",id:"4-run-buz-as-a-cloud-run-service",level:3},{value:"Bonus Points",id:"bonus-points",level:2},{value:"Map a custom domain to Buz",id:"map-a-custom-domain-to-buz",level:3},{value:"Set up a GCS schema registry backend",id:"set-up-a-gcs-schema-registry-backend",level:3},{value:"Push events to BigQuery using a Pub/Sub Subscription",id:"push-events-to-bigquery-using-a-pubsub-subscription",level:3},{value:"Load test the thing",id:"load-test-the-thing",level:3},{value:"Use Terraform to set things up instead of the ui",id:"use-terraform-to-set-things-up-instead-of-the-ui",level:3}],u={toc:d};function m(e){var t=e.components,s=(0,i.Z)(e,r);return(0,o.kt)("wrapper",(0,a.Z)({},u,s,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"gcp"},"GCP"),(0,o.kt)("h2",{id:"deploying-to-cloud-run-in-4-steps"},"Deploying to Cloud Run (in 4 steps)"),(0,o.kt)("p",null,"The easiest way to deploy Buz on GCP is via ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("a",{parentName:"strong",href:"https://cloud.google.com/run"},"Google Cloud Run")),"."),(0,o.kt)("p",null,"The base deployment consists of ",(0,o.kt)("strong",{parentName:"p"},"four GCP resources:")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Two Pub/Sub topics")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"One Secret Manager secret (the configuration)")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"One Cloud Run service"))),(0,o.kt)("p",null,"It has some pretty nifty benefits including:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Impressive cost efficiences via continuously-autoscaling infrastructure.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Minimal moving pieces to set up and maintain.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Logging and metrics out of the box.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},(0,o.kt)("a",{parentName:"strong",href:"https://cloud.google.com/run/sla"},"SLA's")," with financial credits from Google if they are broken."))),(0,o.kt)("h3",{id:"1-create-pubsub-topics"},"1. Create ",(0,o.kt)("a",{parentName:"h3",href:"https://console.cloud.google.com/cloudpubsub/"},"Pub/Sub")," topics."),(0,o.kt)("p",null,"You'll want two Pub/Sub topics - one for ",(0,o.kt)("inlineCode",{parentName:"p"},"valid")," events and the other for ",(0,o.kt)("inlineCode",{parentName:"p"},"invalid")," events."),(0,o.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"Yo")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},'It is entirely possible to only use one output topic but if you want the upside of redirecting events that fail validation out of the "happy path", two topics are necessary.'))),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Create the ",(0,o.kt)("inlineCode",{parentName:"strong"},"buz-valid")," and ",(0,o.kt)("inlineCode",{parentName:"strong"},"buz-invalid")," Pub/Sub topics:")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"create topic",src:n(1615).Z,width:"2546",height:"1228"})),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"configure topic",src:n(7029).Z,width:"3354",height:"1626"})),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"The result should look like:")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"desired result",src:n(6666).Z,width:"3342",height:"1374"})),(0,o.kt)("hr",null),(0,o.kt)("h3",{id:"2-upload-config-to-secret-manager"},"2. Upload config to ",(0,o.kt)("a",{parentName:"h3",href:"https://console.cloud.google.com/security/secret-manager"},"Secret Manager"),"."),(0,o.kt)("p",null,"For the sake of keeping your secrets a.. secret.. uploading the entire Buz config yml to Secret Manager is the easiest way forward."),(0,o.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"YO")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"We've provided a working config sample that you can ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/silverton-io/buz-docs/blob/main/examples/deploy/gcp/config.yml"},"copy/paste to Secret Manager here"),"."))),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Create Buz config as a Secret Manager secret:")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"create secret",src:n(1636).Z,width:"2980",height:"1334"})),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"configure secret",src:n(3625).Z,width:"2736",height:"1710"})),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"If all is well you'll see:")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"desired secret",src:n(7517).Z,width:"3366",height:"1646"})),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Grant the default compute service account ",(0,o.kt)("a",{parentName:"strong",href:"https://console.cloud.google.com/iam-admin/iam"},"appropriate iam access"),". It will need the ",(0,o.kt)("inlineCode",{parentName:"strong"},"Secret Manager Secret Accessor")," role:")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"grant secret accessor",src:n(9534).Z,width:"1704",height:"952"})),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"configure secret accessor",src:n(2057).Z,width:"1918",height:"1154"})),(0,o.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"Yo")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("ul",{parentName:"div"},(0,o.kt)("li",{parentName:"ul"},"While this example uses the ",(0,o.kt)("inlineCode",{parentName:"li"},"default compute service account")," you'll probably want to create a dedicated service user.")))),(0,o.kt)("hr",null),(0,o.kt)("h3",{id:"3-push-image-to-gcp-artifact-registry"},"3. Push image to GCP ",(0,o.kt)("a",{parentName:"h3",href:"https://console.cloud.google.com/artifacts"},"Artifact Registry"),"."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("a",{parentName:"strong",href:"https://console.cloud.google.com/artifacts/create-repo"},"Create a Docker repository")," in GCP Artifact Registry if you don't have one yet:")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"create registry",src:n(2576).Z,width:"3380",height:"1650"})),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Auth to newly-created registry")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"gcloud auth configure-docker us-east1-docker.pkg.dev\nAdding credentials for: us-east1-docker.pkg.dev\n....\nDocker configuration file updated.\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Pull the latest Buz image from the ",(0,o.kt)("a",{parentName:"strong",href:"https://github.com/silverton-io/buz/pkgs/container/buz"},"Github container registry")),":"),(0,o.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"AMD64")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("ul",{parentName:"div"},(0,o.kt)("li",{parentName:"ul"},"At the time of writing Google Cloud Run doesn't support ARM64-based images so you'll need to grab the AMD64 image.")))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"docker pull ghcr.io/silverton-io/buz:v0.11.10@sha256:26cb7d4ee81c29b26dcb4341c34805fe8edc5cdeb616d819be25688dc115f205 # amd64\n\nghcr.io/silverton-io/buz@sha256:26cb7d4ee81c29b26dcb4341c34805fe8edc5cdeb616d819be25688dc115f205: Pulling from silverton-io/buz\nDigest: sha256:26cb7d4ee81c29b26dcb4341c34805fe8edc5cdeb616d819be25688dc115f205\nStatus: Image is up to date for ghcr.io/silverton-io/buz@sha256:26cb7d4ee81c29b26dcb4341c34805fe8edc5cdeb616d819be25688dc115f205\nghcr.io/silverton-io/buz:v0.11.10@sha256:26cb7d4ee81c29b26dcb4341c34805fe8edc5cdeb616d819be25688dc115f205 # Note! Use applicable version here\n\nv0.11.10: Pulling from silverton-io/buz\nDigest: sha256:e70de1a6163e7756474c75fc96b6ebb07270bb6940372d348c1ba255f07a67a1\nStatus: Image is up to date for ghcr.io/silverton-io/buz:v0.11.10\nghcr.io/silverton-io/buz:v0.11.10\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Tag and push the latest Buz image to Artifact Registry:")),(0,o.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"Use your own Artifact Registry URL")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"This example uses the Silverton registry url - you'll need to use your own."),(0,o.kt)("p",{parentName:"div"},"It's structured as: ",(0,o.kt)("inlineCode",{parentName:"p"},"$ARTIFACT_REGISTRY_URL/$GCP_PROJECT/$REGISTRY_NAME/buz:$VERSION")))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"docker tag ghcr.io/silverton-io/buz:v0.11.10@sha256:26cb7d4ee81c29b26dcb4341c34805fe8edc5cdeb616d819be25688dc115f205 us-east1-docker.pkg.dev/silverton-docs/registry/buz:v0.11.10\n\ndocker push us-east1-docker.pkg.dev/silverton-docs/registry/buz:v0.11.10\nThe push refers to repository [us-east1-docker.pkg.dev/silverton-docs/registry/buz]\n3782d1c64659: Pushed\ndf4afbed8e0e: Pushed\n2ddb525329ee: Pushed\ne06c18587270: Pushed\n45369456adf2: Pushed\n840d11aaaa44: Pushed\n20a9c1d833b9: Pushed\nv0.11.10: digest: sha256:28d8fda0fb75956a13b33c3cd03e00ab728d65690adfd803d73cc418ef0db1dc size: 1780\n")),(0,o.kt)("hr",null),(0,o.kt)("h3",{id:"4-run-buz-as-a-cloud-run-service"},"4. Run Buz as a ",(0,o.kt)("a",{parentName:"h3",href:"https://console.cloud.google.com/run"},"Cloud Run")," service."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Create a new ",(0,o.kt)("inlineCode",{parentName:"strong"},"Buz")," service:")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"create service",src:n(2165).Z,width:"3384",height:"1662"})),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"configure service 1",src:n(2631).Z,width:"2412",height:"1288"})),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"configure service 2",src:n(1429).Z,width:"2668",height:"1354"})),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"configure service 3",src:n(6387).Z,width:"2640",height:"1428"})),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Verify service is running (using out-of-the-box metrics and logs):")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"verify service",src:n(7694).Z,width:"3120",height:"788"})),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"service metrics",src:n(5350).Z,width:"3110",height:"1638"})),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"service logs",src:n(588).Z,width:"3112",height:"1640"})),(0,o.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"Yo")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("ul",{parentName:"div"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Log verbosity is cranked in the example configuration.")," You'll probably want less."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"The stdout sink is included for feedback purposes.")," You'll probably want to turn it off."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"The above screenshots are all GCP Cloud Run defaults.")," You'll probably want to tune them.")))),(0,o.kt)("h2",{id:"bonus-points"},"Bonus Points"),(0,o.kt)("h3",{id:"map-a-custom-domain-to-buz"},"Map a ",(0,o.kt)("a",{parentName:"h3",href:"https://cloud.google.com/run/docs/mapping-custom-domains"},"custom domain")," to Buz"),(0,o.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"Yo")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"While this step is ",(0,o.kt)("strong",{parentName:"p"},"technically optional"),", some Buz functionality like server-side identity cookies ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("em",{parentName:"strong"},"will not work without it."))))),(0,o.kt)("p",null,"It takes a minute to map a domain/subdomain to a GCP Cloud Run service. Here's how to do it."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Add mapping:")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"manage domains",src:n(8021).Z,width:"3118",height:"1308"})),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"add mapping",src:n(696).Z,width:"3116",height:"1334"})),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Follow directions to update your dns records:")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"service mapping and dns",src:n(7069).Z,width:"3110",height:"1620"})),(0,o.kt)("hr",null),(0,o.kt)("h3",{id:"set-up-a-gcs-schema-registry-backend"},"Set up a GCS schema registry backend"),(0,o.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"Yo")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("ul",{parentName:"div"},(0,o.kt)("li",{parentName:"ul"},"While this step is optional, you'll need to do it when using custom schemas."),(0,o.kt)("li",{parentName:"ul"},"Buz supports a number of ",(0,o.kt)("a",{parentName:"li",href:"/category/schema-cache-backends"},"schema cache backends"),", so you can just as easily use a different backend.")))),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Create a GCS bucket for schemas:")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"create bucket",src:n(8094).Z,width:"3110",height:"1612"})),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"configure bucket",src:n(6080).Z,width:"3102",height:"1638"})),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Copy schemas to the new schema bucket using ",(0,o.kt)("a",{parentName:"strong",href:"https://cloud.google.com/storage/docs/gsutil"},"gsutil"),":")),(0,o.kt)("p",null,"(From ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/silverton-io/buz"},"buz")," root)"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"buz \u276f\u276f\u276f gsutil cp -r schemas/*  gs://$THE_BUCKET_YOU_JUST_CREATED\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Reconfigure Buz with a new schema registry backend:")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"schemaCache:\n  backend:\n    type: gcs\n    bucket: $THE_BUCKET_YOU_JUST_CREATED\n    path: /\n")),(0,o.kt)("hr",null),(0,o.kt)("h3",{id:"push-events-to-bigquery-using-a-pubsub-subscription"},"Push events to ",(0,o.kt)("a",{parentName:"h3",href:"https://cloud.google.com/bigquery"},"BigQuery")," using a Pub/Sub Subscription"),(0,o.kt)("p",null,"With the announcment of ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("a",{parentName:"strong",href:"https://cloud.google.com/pubsub/docs/bigquery"},"BigQuery Subscriptions"))," pushing events straight to BigQuery is easier than ever."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"FIXME - document this")),(0,o.kt)("hr",null),(0,o.kt)("h3",{id:"load-test-the-thing"},"Load test the thing"),(0,o.kt)("p",null,"Because it's fun."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"FIXME - document this too")),(0,o.kt)("h3",{id:"use-terraform-to-set-things-up-instead-of-the-ui"},"Use Terraform to set things up instead of the ui"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"FIXME - meeee tooo")))}m.isMDXComponent=!0},696:function(e,t,n){t.Z=n.p+"assets/images/add-domain-mapping-fb473a0bc4f645b01e2f687a1f7f5868.png"},6080:function(e,t,n){t.Z=n.p+"assets/images/configure-bucket-582bccb5ab042bd7dff291d2204fc60c.png"},2057:function(e,t,n){t.Z=n.p+"assets/images/configure-secret-accessor-6636ee09f041e40aaed50aa11b067b18.png"},3625:function(e,t,n){t.Z=n.p+"assets/images/configure-secret-bbe2f0f237bcd646c3c454ada7bd744a.png"},2631:function(e,t,n){t.Z=n.p+"assets/images/configure-service-1-a839682a6612e44a627789f30240e9ad.png"},1429:function(e,t,n){t.Z=n.p+"assets/images/configure-service-2-cfb25150cfb117c732638e732dc41441.png"},6387:function(e,t,n){t.Z=n.p+"assets/images/configure-service-3-6486398dcc88fccda86f6627f33bd76d.png"},8094:function(e,t,n){t.Z=n.p+"assets/images/create-bucket-af840e377e0819fd0cae7bb051e8311a.png"},2576:function(e,t,n){t.Z=n.p+"assets/images/create-registry-b3c18979a59247e812157ad97cd66d20.png"},1636:function(e,t,n){t.Z=n.p+"assets/images/create-secret-251d61ce21ac9d9d77d54d3a3f43dee2.png"},2165:function(e,t,n){t.Z=n.p+"assets/images/create-service-245e35f93bebfbc6264c6f30b297ccfe.png"},1615:function(e,t,n){t.Z=n.p+"assets/images/create-topic-6573ea1de49ff77983500ece8901fb06.png"},6666:function(e,t,n){t.Z=n.p+"assets/images/desired-result-1824a2021de184acedb77032e1d4f7b3.png"},7517:function(e,t,n){t.Z=n.p+"assets/images/desired-secret-48bdedea42580b2f98e190d20ae8e01a.png"},7694:function(e,t,n){t.Z=n.p+"assets/images/desired-service-709598f5cf811df5f2cbd7b7ac90129d.png"},9534:function(e,t,n){t.Z=n.p+"assets/images/grant-secret-accessor-36efe4320302cfa4df98008146b7dc17.png"},8021:function(e,t,n){t.Z=n.p+"assets/images/manage-custom-domains-61c9e9df53a4033f41ff1412c039af7b.png"},588:function(e,t,n){t.Z=n.p+"assets/images/service-logs-e589ea4fa3603fcf8ba8f391adb00c51.png"},7069:function(e,t,n){t.Z=n.p+"assets/images/service-mapping-and-dns-68fea729c4f55c937896c9f7d519543a.png"},5350:function(e,t,n){t.Z=n.p+"assets/images/service-metrics-475728827a187e62ed5b7b83106acd28.png"},7029:function(e,t,n){t.Z=n.p+"assets/images/topic-config-039518f3d915030d2dd098b7bc8accd6.png"}}]);